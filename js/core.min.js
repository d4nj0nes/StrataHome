!function($){var app={scrollDistance:0,init:function(){app.interactive(),$(window).resize(function(){app.resizeEvents(),app.scrollEvents()}).resize(),$(window).scroll(function(){app.scrollEvents()}).scroll(),app.wpClean(),app.infiniteScroll(),app.animateLogo(),app.detectFeatures(),$("html").addClass("has-js")},interactive:function(){Modernizr.touchevents&&$(".menu-item-has-children > a").click(function(e){e.preventDefault()}),$("body").on("click",".js-social-share",function(e){e.preventDefault(),app.socialClick($(this).attr("href"))}),$(".js-toggle-menu").click(function(e){e.preventDefault();var id=$(this).attr("href"),menu=$(id),focus=$(this).attr("data-focus"),otherToggles=$('[href="'+id+'"]');menu.toggleClass("is-active"),otherToggles.toggleClass("is-active"),focus&&$(focus).length&&(menu.hasClass("is-active")?setTimeout(function(){$(focus).focus()},500):$(focus).blur())}),$(".n_mobile .menu-item-has-children > a").click(function(e){e.preventDefault();var parent=$(this).parents("li");siblings=parent.siblings(".menu-item-has-children"),siblings.hasClass("is-active")&&($(".n_mobile .menu-item-has-children.is-active .sub-menu").slideUp(),$(".n_mobile .menu-item-has-children.is-active").removeClass("is-active")),parent.toggleClass("is-active"),parent.children(".sub-menu").slideToggle()}),$("body").on("click",".js-modal-trigger",function(e){e.preventDefault();var modal=$(this).attr("href");$(".js-modal-overlay").addClass("is-active"),$(modal).addClass("is-active"),$("body").css("overflow","hidden")}),$("body").on("click",".js-modal-overlay, .js-modal-close",function(e){e.preventDefault(),$(".js-modal-overlay").removeClass("is-active"),$(".js-modal.is-active").removeClass("is-active"),$("body").removeAttr("style")}),$(document).keydown(function(e){27===e.keyCode&&$(".js-modal-close").click()}),$(".js-accordion-toggle").click(function(e){e.preventDefault();var group=$(this).parents(".js-accordion-group"),section=$(this).parents(".js-accordion-section"),content=$(this).siblings(".js-accordion-content");if($(".js-accordion-section",group).hasClass("is-active")&&!section.hasClass("is-active")){var old_section=$(".js-accordion-section.is-active",group),old_content=$(".js-accordion-content",old_section);old_section.removeClass("is-active"),$(".js-accordion-class",old_section).removeClass("is-active"),old_content.slideUp(300)}section.toggleClass("is-active"),$(".js-accordion-class",section).toggleClass("is-active"),content.slideToggle(300)}),$(".js-trigger-scroll").click(function(e){e.preventDefault();var newScroll=$(this).attr("href");$(this).hasClass("scroll-top")?newScroll=0:(newScroll=$(newScroll).offset().top,newScroll-=$("header").height(),$(this).hasClass("js-sticky-scroll-section")&&(newScroll-=$(this).height())),$("body, html").animate({scrollTop:newScroll},750)}),$(".f_fieldset__input").on("change",function(){$(this).val().length?$(this).parents("fieldset").addClass("is-full"):$(this).parents("fieldset").removeClass("is-full")}),$(".js-contact-form").submit(function(){var form=$(this),button=$("[type=submit]",form);return form.addClass("f_is-loading"),$(".f_error",form).removeClass("f_error"),$(".f_error-msg",form).remove(),button.prop("disabled",!0),$.post(form.attr("action"),form.serialize(),function(r){if(r.success){var formWrapper=form.parents(".f_wrapper");$(".f_success",formWrapper).show(),$(".f_form, .f_hide",formWrapper).hide();var scroll=formWrapper.offset().top-2*$("header").height();$("body, html").animate({scrollTop:scroll},750)}else button.prop("disabled",!1),$.each(r.errors,function(k,v){var input=$("[name="+k+"]"),parent=input.parents("fieldset");parent.addClass("f_error"),parent.append('<div class="f_error-msg t_accent t_c--primary">'+v+"</div>")});form.removeClass("f_is-loading")}),!1}),$(".js-grid-filter").click(function(e){e.preventDefault();var filters=$(".js-grid-filter"),selector=$($(this).attr("data-filter")).filter(".js-grid-filterable"),filterables=$(".js-grid-filterable");newTop=$(".js-filter-sticky").offset().top-$("header").height()-1,filters.removeClass("is-active"),$(this).addClass("is-active"),filterables.hide(),selector.show(),$(".m_filters__filter").hasClass("is-active")&&$(".m_filters__filter").click(),$(window).scrollTop()>newTop&&$(window).scrollTop(newTop)})},resizeEvents:function(){},scrollEvents:function(){app.scrollDistance=$(window).scrollTop(),$(".js-scroll-wrapper").length&&app.scrollSection(),$(".js-filter-sticky").length&&app.filterSticky(),$(".js-sticky-scroll-section").length&&app.stickyScroll(),$(".m_tc").length&&app.stickyTc()},wpClean:function(){$('p:has(img:not(".wp-smiley"):not(".emoji"))').addClass("has-img"),$(".wp-caption").addClass("has-img"),$("p:has(iframe)").addClass("has-embed"),$(".has-embed").fitVids()},socialClick:function(url){var leftPosition,topPosition,width,height;width=550,height=450,leftPosition=window.screen.width/2-(width/2+10),topPosition=window.screen.height/2-(height/2+50);var windowFeatures="status=no,height="+height+",width="+width+",resizable=no,left="+leftPosition+",top="+topPosition+",screenX="+leftPosition+",screenY="+topPosition+",toolbar=no,menubar=no,scrollbars=no,location=no,directories=no";return window.open(url,"sharer",windowFeatures),!1},infiniteScroll:function(){$(".js-infinite").length&&$(".js-infinite").infinitescroll({loading:{finishedMsg:"No more posts.",msgText:"Loading more posts..."},itemSelector:".js-infinite-item",nextSelector:".js-infinite-next a",navSelector:".js-infinite-pager"})},animateLogo:function(){if($(".js-bodymovin").length){var animData={wrapper:document.getElementById("bodymovin"),renderer:"svg",loop:!1,autoplay:!0,path:"../wp-content/themes/gotostrata2016/js/strata.json"};bodymovin.loadAnimation(animData)}},scrollSection:function(){$(".js-scroll-section").each(function(){var itemTop=$(this).offset().top,itemBottom=itemTop+$(this).outerHeight(),windowMid=$(window).height()/2,targetTop=itemTop-windowMid,targetBottom=itemBottom-windowMid;app.scrollDistance>=targetTop?$(this).addClass("is-active"):$(this).removeClass("is-active"),app.scrollDistance;var activeSection=$(".js-scroll-section.is-active").last(),pager=$(".js-scroll-pager");if(activeSection.length){var pagerMargin=parseInt(pager.css("margin-top")),newHeight=(activeSection.position().top,activeSection.outerHeight(),$(".m_illo-grid__bobble",activeSection).offset().top-$(".js-scroll-wrapper").offset().top-pagerMargin);console.log(itemTop),pager.height(newHeight)}else pager.removeAttr("style")})},filterSticky:function(){var target=$(".js-filter-sticky").offset().top-$("header").height();if(app.scrollDistance>=target&&$(window).width()>=980?$(".js-filter-sticky-nav").addClass("is-sticky u_bg--primary"):$(".js-filter-sticky-nav").removeClass("is-sticky u_bg--primary"),$(".js-filter-sticky-bottom").length){var targetBottom=$(".js-filter-sticky-bottom").offset().top-$("header").height()-$(".js-filter-sticky-nav").height(),newTop=$(".js-filter-sticky-bottom").offset().top-$(".js-filter-sticky-nav").height()-$(".js-filter-sticky").offset().top;app.scrollDistance>=targetBottom&&$(window).width()>=980?$(".js-filter-sticky-nav").addClass("is-absolute").css("top",newTop+"px"):$(".js-filter-sticky-nav").removeClass("is-absolute").removeAttr("style")}},stickyScroll:function(){var section={};$(".js-sticky-scroll-section").each(function(){if(section.el=$($(this).attr("href")),section.top=section.el.offset().top-$("header").height()-$(this).height(),section.bottom=section.el.next().offset().top+section.el.next().height()-$(this).height()-10,app.scrollDistance>=section.top&&app.scrollDistance<section.bottom)return $(".js-sticky-scroll-section").removeClass("is-active"),$(this).addClass("is-active"),!1;$(".js-sticky-scroll-section").removeClass("is-active")})},stickyTc:function(){if($(window).width()<980){var headline=$(".m_tc--l");return headline.removeAttr("style"),headline.removeClass("sticky absolute"),!1}var sections=$(".m_tc__wrapper"),offset=$("header").height()-2;$(".js-filter-sticky-nav.is-sticky").length&&(offset+=$(".js-filter-sticky-nav.is-sticky").height()),sections.each(function(){var section=$(this),headline=$(".m_tc--l",section),target={};target.t=section.offset().top-offset,target.b=target.t+section.height()-headline.height(),app.scrollDistance>=target.t&&app.scrollDistance<target.b?headline.hasClass("sticky")||(headline.removeClass("absolute"),headline.removeAttr("style"),headline.addClass("sticky"),headline.css({position:"fixed",top:offset,width:headline.width()})):app.scrollDistance>=target.b?headline.hasClass("absolute")||(headline.removeClass("sticky"),headline.addClass("absolute"),headline.css({position:"absolute",top:"auto",bottom:0})):(headline.removeAttr("style"),headline.removeClass("sticky absolute"))})},detectFeatures:function(){/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||$("html").addClass("mz-hover");var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE "),trident=ua.indexOf("Trident/");(msie>0||trident>0)&&$("html").addClass("ie")}};$(document).ready(function(){app.init()})}(jQuery);